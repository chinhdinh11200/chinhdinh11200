name: happy_coding

on:
  schedule:
    # Runs at 00:00 GMT+7 on January 1st every year
    - cron: '0 17 31 12 *'
  workflow_dispatch: # Allows manual trigger for testing

permissions:
  contents: write

jobs:
  update-readme:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Update happy-code section
        run: |
          YEAR=$(date +%Y)
          ENTRY="    <p>Happy code for $YEAR</p>"
      
          if grep -q "$ENTRY" README.md; then
            echo "Already exists"
            exit 0
          fi
      
          awk -v entry="$ENTRY" '
            /<div id="happy-code" align="center">/ {
              print
              print entry
              next
            }
            { print }
          ' README.md > README.tmp && mv README.tmp README.md

      - name: Commit and push changes
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add README.md
          git diff --quiet && git diff --staged --quiet || (git commit -m "ðŸŽ‰ Happy code for $(date +%Y)" && git push)
